app.controller("queryOilShift",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","myPublicMethod","$translate",function(n,e,o,i,s,r,t){n.selected_customerId="0",n.app.myData.customerListNoAll=n.app.myData.customerList.slice(0),"0"==n.app.myData.customerListNoAll[0].customerId&&n.app.myData.customerListNoAll.splice(0,1),n.saleMoney=t.instant("items.oilShiftQuery.saleMoney"),n.realMoney=t.instant("items.oilShiftQuery.realMoney"),n.default_search_select_station_list={stationId:"0",stationName:t.instant("public.all")},n.search_select_station_list=[n.default_search_select_station_list],n.selected_stationId="0",0!=n.app.myData.role&&(n.selected_customerId=n.app.myData.customerListNoAll[0].customerId),s.getStationListSendData.sessionId=n.app.myData.sessionId,n.callback_getStationList=function(e){n.search_select_station_list=n.search_select_station_list.concat(e.fieldValues),"0"!=n.selected_customerId?n.getOilShiftListSendData.where=" customerId='"+n.selected_customerId+"'":n.getOilShiftListSendData.where="",console.log(n.getOilShiftListSendData),1!=n.pagingOptions.currentPage&&(n.pagingOptions.currentPage=1)},n.selectCustomerChange=function(){console.log("看看执行几次22222222"),n.search_select_station_list=[n.default_search_select_station_list],"0"!=n.selected_customerId?s.getStationListSendData.where=" customerId='"+n.selected_customerId+"'":s.getStationListSendData.where="",i.myPost2(s.URL.systemUrl,s.getStationListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,n.callback_getStationList)},1==n.app.myData.role&&n.selectCustomerChange(),n.selectStationChange=function(){"0"!=n.selected_stationId?n.getOilShiftListSendData.where=" stationId='"+n.selected_stationId+"'":"0"!=n.selected_customerId?n.getOilShiftListSendData.where=" customerId='"+n.selected_customerId+"'":n.getOilShiftListSendData.where="",1!=n.pagingOptions.currentPage?n.pagingOptions.currentPage=1:n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.getOilShiftListSendData)},n.getOilShiftListSendData={sessionId:n.app.myData.sessionId,tableName:"view_oilshift_station",fields:[],where:"",limit:"",offset:""},n.filterOptions={filterText:"",useExternalFilter:!0},n.totalServerItems=0,n.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},n.columnDefs=[{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:t.instant("items.stationManage.stationName"),width:"*"},{field:"shiftNum",displayName:t.instant("items.shiftQuery.shiftNum"),width:"*"},{field:"oilName",displayName:t.instant("items.oilManage.oilName"),width:"*"},{field:"startVolume",displayName:t.instant("items.oilShiftQuery.startVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"inVolume",displayName:t.instant("items.oilShiftQuery.inVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"outVolume",displayName:t.instant("items.oilShiftQuery.outVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"endVolume",displayName:t.instant("items.oilShiftQuery.endVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"saleMoney",displayName:t.instant("items.oilShiftQuery.saleMoney"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"},{field:"realMoney",displayName:t.instant("items.oilShiftQuery.realMoney"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"},{field:"discount",displayName:t.instant("items.oilShiftQuery.discount"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"}],n.callback=function(e){n.myData=e.fieldValues,n.totalServerItems=e.allCount,o.clear(),n.d0_1=[],n.d0_2=[],n.chart_ticks=[];for(var t=0;t<e.fieldValues.length;t++){var a=parseInt(e.fieldValues[t].saleMoney,10),i=r.getMoneyAndDec(n.app.myData.parameters,e.fieldValues[t].stationId,a);n.d0_1[t]=[t,parseFloat(i)];var s=parseInt(e.fieldValues[t].realMoney,10),l=r.getMoneyAndDec(n.app.myData.parameters,e.fieldValues[t].stationId,s);n.d0_2[t]=[t,parseFloat(l)],n.chart_ticks[t]=[t,e.fieldValues[t].shiftNum]}},n.d0_1=[],n.d0_2=[],n.chart_ticks=[],n.setPagingData=function(e,t){n.getOilShiftListSendData.offset=1==e?0:(e-1)*t,n.getOilShiftListSendData.limit=t,i.myPost2(s.URL.systemUrl,n.getOilShiftListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,n.callback)},n.getPagedDataAsync=function(e,t,a){setTimeout(function(){o.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.loadingData),n.setPagingData(t,e)},100)},n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage),n.$watch("pagingOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.$watch("filterOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.gridOptions={i18n:"undefined"!=n.app.myData.lang?n.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:n.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!1,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,filterOptions:n.filterOptions},n.goExcel=function(){console.log("班结开始导出excel");var a=JSON.parse(JSON.stringify(n.getOilShiftListSendData));a.limit=0,a.offset=0,a.toExcel=1,a.headers=[],a.keys=[],a.widths=[],n.columnDefs.forEach(function(e,t){a.headers.push(e.displayName),a.keys.push(e.field),a.widths.push(9)});i.myPost2(s.URL.systemUrl,a,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,function(e){console.log(e),console.log(window.location.host+"/web/"+e.excelPath),window.open("http://"+window.location.host+"/web/"+e.excelPath)})}}]);