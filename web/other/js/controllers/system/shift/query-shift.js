app.controller("queryShift",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(s,t,i,n,l,e){s.selected_customerId="0",s.app.myData.customerListNoAll=s.app.myData.customerList.slice(0),"0"==s.app.myData.customerListNoAll[0].customerId&&s.app.myData.customerListNoAll.splice(0,1),s.default_search_select_station_list={stationId:"0",stationName:e.instant("public.all")},s.search_select_station_list=[s.default_search_select_station_list],s.selected_stationId="0",0!=s.app.myData.role&&(s.selected_customerId=s.app.myData.customerListNoAll[0].customerId),l.getStationListSendData.sessionId=s.app.myData.sessionId,s.callback_getStationList=function(t){s.search_select_station_list=s.search_select_station_list.concat(t.fieldValues),"0"!=s.selected_customerId?s.getShiftListSendData.where=" customerId='"+s.selected_customerId+"'":s.getShiftListSendData.where="",console.log(s.getShiftListSendData),1!=s.pagingOptions.currentPage&&(s.pagingOptions.currentPage=1)},s.selectCustomerChange=function(){s.search_select_station_list=[s.default_search_select_station_list],"0"!=s.selected_customerId?l.getStationListSendData.where=" customerId='"+s.selected_customerId+"'":l.getStationListSendData.where="",n.myPost2(l.URL.systemUrl,l.getStationListSendData,l.msgIdName.normalSelectMsgId,l.msgIdName.normalSelectMsgName,s.callback_getStationList)},1==s.app.myData.role&&s.selectCustomerChange(),s.selectStationChange=function(){"0"!=s.selected_stationId?s.getShiftListSendData.where=" stationId='"+s.selected_stationId+"'":"0"!=s.selected_customerId?s.getShiftListSendData.where=" customerId='"+s.selected_customerId+"'":s.getShiftListSendData.where="",1!=s.pagingOptions.currentPage?s.pagingOptions.currentPage=1:s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage)},s.getShiftListSendData={sessionId:s.app.myData.sessionId,tableName:"view_shift_station_staffinfo",fields:[],where:"",limit:"",offset:""},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.columnDefs=[{field:"stationId",displayName:e.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:e.instant("items.stationManage.stationName"),width:"*"},{field:"shiftNum",displayName:e.instant("items.shiftQuery.shiftNum"),width:"*"},{field:"startTime",displayName:e.instant("items.shiftQuery.startTime"),width:140,cellFilter:"filterDateStringSplitMs"},{field:"endTime",displayName:e.instant("items.shiftQuery.endTime"),width:140,cellFilter:"filterDateStringSplitMs"},{field:"userId",displayName:e.instant("items.staffManage.userId"),width:"*"},{field:"name",displayName:e.instant("items.staffManage.name"),width:"*"},{field:"createTime",displayName:e.instant("items.staffManage.createTime"),width:140,cellFilter:"filterDateStringSplitMs"}],s.callback=function(t){s.myData=t.fieldValues,s.totalServerItems=t.allCount,i.clear()},s.setPagingData=function(t,e){s.getShiftListSendData.offset=1==t?0:(t-1)*e,s.getShiftListSendData.limit=e,n.myPost2(l.URL.systemUrl,s.getShiftListSendData,l.msgIdName.normalSelectMsgId,l.msgIdName.normalSelectMsgName,s.callback)},s.getPagedDataAsync=function(t,e,a){setTimeout(function(){i.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(e,t)},100)},s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage),s.$watch("pagingOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(t,e){t!==e&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!1,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,filterOptions:s.filterOptions},s.goExcel=function(){console.log("班结开始导出excel");var a=JSON.parse(JSON.stringify(s.getShiftListSendData));a.limit=0,a.offset=0,a.toExcel=1,a.headers=[],a.keys=[],a.widths=[],s.columnDefs.forEach(function(t,e){a.headers.push(t.displayName),a.keys.push(t.field),a.widths.push(9)});n.myPost2(l.URL.systemUrl,a,l.msgIdName.normalSelectMsgId,l.msgIdName.normalSelectMsgName,function(t){console.log(t),console.log(window.location.host+"/web/"+t.excelPath),window.open("http://"+window.location.host+"/web/"+t.excelPath)})}}]);