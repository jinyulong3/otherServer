app.controller("queryTankShift",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","myPublicMethod","$translate",function(l,t,o,i,s,r,e){l.selected_customerId="0",l.startShiftVolume=e.instant("items.tankShiftQuery.startShiftVolume"),l.endShiftVolume=e.instant("items.tankShiftQuery.endShiftVolume"),l.app.myData.customerListNoAll=l.app.myData.customerList.slice(0),"0"==l.app.myData.customerListNoAll[0].customerId&&l.app.myData.customerListNoAll.splice(0,1),l.default_search_select_station_list={stationId:"0",stationName:e.instant("public.all")},l.search_select_station_list=[l.default_search_select_station_list],l.selected_stationId="0",0!=l.app.myData.role&&(l.selected_customerId=l.app.myData.customerListNoAll[0].customerId),s.getStationListSendData.sessionId=l.app.myData.sessionId,l.callback_getStationList=function(t){l.search_select_station_list=l.search_select_station_list.concat(t.fieldValues),"0"!=l.selected_customerId?l.getTankShiftListSendData.where=" customerId='"+l.selected_customerId+"'":l.getTankShiftListSendData.where="",console.log(l.getTankShiftListSendData),1!=l.pagingOptions.currentPage&&(l.pagingOptions.currentPage=1)},l.selectCustomerChange=function(){l.search_select_station_list=[l.default_search_select_station_list],"0"!=l.selected_customerId?s.getStationListSendData.where=" customerId='"+l.selected_customerId+"'":s.getStationListSendData.where="",i.myPost2(s.URL.systemUrl,s.getStationListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,l.callback_getStationList)},1==l.app.myData.role&&l.selectCustomerChange(),l.selectStationChange=function(){"0"!=l.selected_stationId?l.getTankShiftListSendData.where=" stationId='"+l.selected_stationId+"'":"0"!=l.selected_customerId?l.getTankShiftListSendData.where=" customerId='"+l.selected_customerId+"'":l.getTankShiftListSendData.where="",1!=l.pagingOptions.currentPage?l.pagingOptions.currentPage=1:l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.getTankShiftListSendData)},l.getTankShiftListSendData={sessionId:l.app.myData.sessionId,tableName:"view_tankshift_station",fields:[],where:"",limit:"",offset:""},l.filterOptions={filterText:"",useExternalFilter:!0},l.totalServerItems=0,l.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},l.columnDefs=[{field:"stationId",displayName:e.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:e.instant("items.stationManage.stationName"),width:"*"},{field:"shiftNum",displayName:e.instant("items.shiftQuery.shiftNum"),width:"*"},{field:"tankId",displayName:e.instant("items.tankManage.tankNo"),width:"*"},{field:"startVolume",displayName:e.instant("items.tankShiftQuery.startShiftVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"inVolume",displayName:e.instant("items.tankShiftQuery.inVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"outVolume",displayName:e.instant("items.tankShiftQuery.outVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"endVolume",displayName:e.instant("items.tankShiftQuery.endShiftVolume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"startHeight",displayName:e.instant("items.tankShiftQuery.startHeight"),width:"*",cellFilter:"filterSystemPraHeightDec:this"},{field:"endHeight",displayName:e.instant("items.tankShiftQuery.endHeight"),width:"*",cellFilter:"filterSystemPraHeightDec:this"}],l.callback=function(t){l.myData=t.fieldValues,l.totalServerItems=t.allCount,o.clear(),l.d0_1=[],l.d0_2=[],l.chart_ticks=[];for(var e=0;e<t.fieldValues.length;e++){var a=parseInt(t.fieldValues[e].startVolume,10),i=r.getVolumeAndDec(l.app.myData.parameters,t.fieldValues[e].stationId,a);l.d0_1[e]=[e,parseFloat(i)];var s=parseInt(t.fieldValues[e].endVolume,10),n=r.getVolumeAndDec(l.app.myData.parameters,t.fieldValues[e].stationId,s);l.d0_2[e]=[e,parseFloat(n)],l.chart_ticks[e]=[e,t.fieldValues[e].shiftNum]}},l.d0_1=[],l.d0_2=[],l.chart_ticks=[],l.setPagingData=function(t,e){l.getTankShiftListSendData.offset=1==t?0:(t-1)*e,l.getTankShiftListSendData.limit=e,i.myPost2(s.URL.systemUrl,l.getTankShiftListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,l.callback)},l.getPagedDataAsync=function(t,e,a){setTimeout(function(){o.pop("wait",constantsLang[l.app.myData.lang].load.reqData,constantsLang[l.app.myData.lang].load.loadingData),l.setPagingData(e,t)},100)},l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage),l.$watch("pagingOptions",function(t,e){t!==e&&l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.filterOptions.filterText)},!0),l.$watch("filterOptions",function(t,e){t!==e&&l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.filterOptions.filterText)},!0),l.gridOptions={i18n:"undefined"!=l.app.myData.lang?l.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:l.pagingOptions,enableColumnResizing:!1,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,filterOptions:l.filterOptions},l.goExcel=function(){console.log("班结开始导出excel");var a=JSON.parse(JSON.stringify(l.getTankShiftListSendData));a.limit=0,a.offset=0,a.toExcel=1,a.headers=[],a.keys=[],a.widths=[],l.columnDefs.forEach(function(t,e){a.headers.push(t.displayName),a.keys.push(t.field),a.widths.push(9)});i.myPost2(s.URL.systemUrl,a,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,function(t){console.log(t),console.log(window.location.host+"/web/"+t.excelPath),window.open("http://"+window.location.host+"/web/"+t.excelPath)})}}]);