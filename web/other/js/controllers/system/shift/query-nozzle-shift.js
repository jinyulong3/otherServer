app.controller("queryNozzleShift",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$filter","myPublicMethod","$translate",function(l,e,o,i,s,t,r,a){l.selected_customerId="0",l.moneyInThisShift=a.instant("items.nozzleShiftQuery.money"),l.realMoneyInThisShift=a.instant("items.nozzleShiftQuery.realMoney"),l.app.myData.customerListNoAll=l.app.myData.customerList.slice(0),"0"==l.app.myData.customerListNoAll[0].customerId&&l.app.myData.customerListNoAll.splice(0,1),l.default_search_select_station_list={stationId:"0",stationName:a.instant("public.all")},l.search_select_station_list=[l.default_search_select_station_list],l.selected_stationId="0",0!=l.app.myData.role&&(l.selected_customerId=l.app.myData.customerListNoAll[0].customerId),s.getStationListSendData.sessionId=l.app.myData.sessionId,l.callback_getStationList=function(e){l.search_select_station_list=l.search_select_station_list.concat(e.fieldValues),"0"!=l.selected_customerId?l.getNozzleShiftListSendData.where=" customerId='"+l.selected_customerId+"'":l.getNozzleShiftListSendData.where="",console.log(l.getNozzleShiftListSendData),1!=l.pagingOptions.currentPage&&(l.pagingOptions.currentPage=1)},l.selectCustomerChange=function(){l.search_select_station_list=[l.default_search_select_station_list],"0"!=l.selected_customerId?s.getStationListSendData.where=" customerId='"+l.selected_customerId+"'":s.getStationListSendData.where="",i.myPost2(s.URL.systemUrl,s.getStationListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,l.callback_getStationList)},1==l.app.myData.role&&l.selectCustomerChange(),l.selectStationChange=function(){console.log(l.selected_stationId),"0"!=l.selected_stationId?l.getNozzleShiftListSendData.where=" stationId='"+l.selected_stationId+"'":"0"!=l.selected_customerId?l.getNozzleShiftListSendData.where=" customerId='"+l.selected_customerId+"'":l.getNozzleShiftListSendData.where="",1!=l.pagingOptions.currentPage?l.pagingOptions.currentPage=1:l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.getNozzleShiftListSendData)},l.getNozzleShiftListSendData={sessionId:l.app.myData.sessionId,tableName:"view_nozzleshift_station",fields:[],where:"",limit:"",offset:""},l.filterOptions={filterText:"",useExternalFilter:!0},l.totalServerItems=0,l.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},l.columnDefs=[{field:"stationId",displayName:a.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:a.instant("items.stationManage.stationName"),width:"*"},{field:"shiftNum",displayName:a.instant("items.shiftQuery.shiftNum"),width:"*"},{field:"nozzleNum",displayName:a.instant("items.nozzleManage.logicNozzleNo"),width:"*"},{field:"startTotalizer",displayName:a.instant("items.nozzleShiftQuery.startTotalizer"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"endTotalizer",displayName:a.instant("items.nozzleShiftQuery.endTotalizer"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"volume",displayName:a.instant("items.nozzleShiftQuery.volume"),width:"*",cellFilter:"filterSystemPraVolumeDec:this"},{field:"money",displayName:a.instant("items.nozzleShiftQuery.money"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"},{field:"realMoney",displayName:a.instant("items.nozzleShiftQuery.realMoney"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"},{field:"discount",displayName:a.instant("items.nozzleShiftQuery.discount"),width:"*",cellFilter:"filterSystemPraMoneyDec:this"}],l.callback=function(e){l.myData=e.fieldValues,l.totalServerItems=e.allCount,o.clear(),l.d0_1=[],l.d0_2=[],l.chart_ticks=[];for(var t=0;t<e.fieldValues.length;t++){var a=parseInt(e.fieldValues[t].money,10),i=r.getMoneyAndDec(l.app.myData.parameters,e.fieldValues[t].stationId,a);l.d0_1[t]=[t,parseFloat(i)];var s=parseInt(e.fieldValues[t].realMoney,10),n=r.getMoneyAndDec(l.app.myData.parameters,e.fieldValues[t].stationId,s);l.d0_2[t]=[t,parseFloat(n)],l.chart_ticks[t]=[t,e.fieldValues[t].shiftNum]}},l.setPagingData=function(e,t){l.getNozzleShiftListSendData.offset=1==e?0:(e-1)*t,l.getNozzleShiftListSendData.limit=t,i.myPost2(s.URL.systemUrl,l.getNozzleShiftListSendData,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,l.callback)},l.getPagedDataAsync=function(e,t,a){setTimeout(function(){o.pop("wait",constantsLang[l.app.myData.lang].load.reqData,constantsLang[l.app.myData.lang].load.loadingData),l.setPagingData(t,e)},100)},l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage),l.$watch("pagingOptions",function(e,t){e!==t&&l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.filterOptions.filterText)},!0),l.$watch("filterOptions",function(e,t){e!==t&&l.getPagedDataAsync(l.pagingOptions.pageSize,l.pagingOptions.currentPage,l.filterOptions.filterText)},!0),l.gridOptions={i18n:"undefined"!=l.app.myData.lang?l.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:l.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!1,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!1,filterOptions:l.filterOptions},l.goExcel=function(){console.log("班结开始导出excel");var a=JSON.parse(JSON.stringify(l.getNozzleShiftListSendData));a.limit=0,a.offset=0,a.toExcel=1,a.headers=[],a.keys=[],a.widths=[],l.columnDefs.forEach(function(e,t){a.headers.push(e.displayName),a.keys.push(e.field),a.widths.push(9)});i.myPost2(s.URL.systemUrl,a,s.msgIdName.normalSelectMsgId,s.msgIdName.normalSelectMsgName,function(e){console.log(e),console.log(window.location.host+"/web/"+e.excelPath),window.open("http://"+window.location.host+"/web/"+e.excelPath)})},l.d0_1=[],l.d0_2=[],l.chart_ticks=[]}]);