app.controller("prizedrawManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(s,a,n,o,l,t){s.selected_customerId="0",s.app.myData.customerListNoAll=s.app.myData.customerList.slice(0),"0"==s.app.myData.customerListNoAll[0].customerId&&s.app.myData.customerListNoAll.splice(0,1),0!=s.app.myData.role&&(s.selected_customerId=s.app.myData.customerListNoAll[0].customerId),s.default_search_select_station_list={stationId:"0",stationName:t.instant("public.all")},s.search_select_station_list=[],s.selected_stationId="0",l.getStationListSendData.sessionId=s.app.myData.sessionId,s.callback_getStationList=function(t){s.search_select_station_list=s.search_select_station_list.concat(t.fieldValues),"0"!=s.selected_customerId?s.getPrizedrawList.customerId=s.selected_customerId:s.getPrizedrawList.customerId="",1!=s.pagingOptions.currentPage&&(s.pagingOptions.currentPage=1)},s.selectCustomerChange=function(){console.log(s.selected_customerId),s.search_select_station_list=[],"0"!=s.selected_customerId?(l.getStationListSendData.where=" customerId='"+s.selected_customerId+"'",s.getPrizedrawList.customerId=s.selected_customerId):(l.getStationListSendData.where="",s.getPrizedrawList.customerId=""),o.myPost2(l.URL.systemUrl,l.getStationListSendData,l.msgIdName.normalSelectMsgId,l.msgIdName.normalSelectMsgName,s.callback_getStationList)},1==s.app.myData.role&&s.selectCustomerChange(),s.selectStationChange=function(){console.log(s.selected_stationId),"0"!=s.selected_stationId?(console.log("lllllllllllllllllll"),s.getPrizedrawList.stationId=s.selected_stationId,console.log(s.getPrizedrawList)):s.getPrizedrawList.stationId="",s.goQuery()},s.getPrizedrawList={sessionId:s.app.myData.sessionId,customerId:"",stationId:"",deviceId:"",type:0,limit:"",offset:""},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.columnDefs=[{field:"customerId",displayName:t.instant("items.customerManage.customerNo"),width:"*",visible:!1},{field:"customerName",displayName:t.instant("items.customerManage.customerName"),width:"*"},{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*",visible:!1},{field:"stationName",displayName:t.instant("items.stationManage.stationName"),width:"*"},{field:"prizeDrawId",displayName:"项目编号",width:"*"},{field:"prizeDrawName",displayName:"抽奖项目名称",width:"150"},{field:"prizeDrawItemCount",displayName:"奖项数目",width:"*",visible:!1},{field:"startTime",displayName:"开始时间",width:"150",cellFilter:"filterDateStringSplitMs"},{field:"endTime",displayName:"结束时间",width:"150",cellFilter:"filterDateStringSplitMs"},{field:"isForbidden",displayName:"是否禁用",width:"*",cellClass:"red",cellFilter:"filterPrizeDrawIsForbidden"},{field:"remark",displayName:"备注",width:"*"},{field:"createrId",displayName:"创建人用户名",width:"*"},{field:"updateId",displayName:"修改人用户名",width:"*"},{field:"time_insert",displayName:"创建时间",width:"*",cellFilter:"filterDateStringSplitMs"},{field:"time_update",displayName:"修改时间",width:"*",cellFilter:"filterDateStringSplitMs"}],s.callback=function(t){console.log(t),s.myData=t.prizeDrawList,s.totalServerItems=t.allCount,n.clear()},s.setPagingData=function(t,a){s.getPrizedrawList.offset=1==t?0:(t-1)*a,s.getPrizedrawList.limit=a,o.myPost2(l.URL.systemUrl,s.getPrizedrawList,l.msgIdName.queryPrizedrawMsgId,l.msgIdName.queryPrizedrawMsgName,s.callback)},s.getPagedDataAsync=function(t,a,e){setTimeout(function(){n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(a,t)},100)},s.$watch("pagingOptions",function(t,a){t!==a&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(t,a){t!==a&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:s.filterOptions},s.goQuery=function(){console.log("开始查询"),console.log(s.getPrizedrawList),void 0!==s.getPrizedrawList.customerId&&""!=s.getPrizedrawList.customerId?void 0!==s.getPrizedrawList.stationId&&""!=s.getPrizedrawList.stationId?s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage):n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"请选择站点"):n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"请选择客户")},s.btnClickForbiddenPrizedraw=function(){var t=s.gridOptions.$gridScope.selectedItems;if(console.log(t[0]),0==t.length)n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow);else{var a=JSON.parse(JSON.stringify(t[0]));if(1==a.isForbidden)return void n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"该项目是禁用状态");a.isForbidden=1,a.sessionId=s.app.myData.sessionId,a.datatype=l.cmdType.CHANGE;o.myPost2(l.URL.systemUrl,a,l.msgIdName.managePrizeDrawMsgId,l.msgIdName.managePrizeDrawMsgName,function(t){console.log(t),n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,"已禁用",l.TIMEOUT.timeout1s),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},null),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,"正在禁用中...")}},s.btnClickNoForbiddenPrizedraw=function(){var t=s.gridOptions.$gridScope.selectedItems;if(console.log(t[0]),0==t.length)n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow);else{var a=JSON.parse(JSON.stringify(t[0]));if(0==a.isForbidden)return void n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"该项目是启用状态");a.isForbidden=0,a.sessionId=s.app.myData.sessionId,a.datatype=l.cmdType.CHANGE;o.myPost2(l.URL.systemUrl,a,l.msgIdName.managePrizeDrawMsgId,l.msgIdName.managePrizeDrawMsgName,function(t){console.log(t),n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,"已禁用",l.TIMEOUT.timeout1s),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},null),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,"正在启用中...")}},app.controller("btnClickAddPrizedrawCon",["$scope","$uibModalInstance","info","parentScope",function(e,s,t,i){e.parent=i,e.info=t,e.info.customerId=i.getPrizedrawList.customerId,e.info.stationId=i.getPrizedrawList.stationId,console.log(t),e.ok=function(){e.info.sessionId=i.app.myData.sessionId,e.info.datatype=l.cmdType.ADD,e.info.prizeDrawItemCount=0,e.startDate=$("#startDate").val(),e.stopDate=$("#stopDate").val();var t="2019-01-01",a="2100-01-01";""!=e.startDate&&(t=e.startDate),""!=e.stopDate&&(a=e.stopDate),e.info.startTime=t,e.info.endTime=a,console.log(e.info),e.callback2=function(t){console.log(t),n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.addSuccess,l.TIMEOUT.timeout1s),s.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},o.myPost2(l.URL.systemUrl,e.info,l.msgIdName.managePrizeDrawMsgId,l.msgIdName.managePrizeDrawMsgName,e.callback2,s),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.addingData)},e.cancel=function(){console.log(e.info),s.dismiss(0)}}]),s.btnClickAddPrizedraw=function(){void 0!==s.getPrizedrawList.customerId&&""!=s.getPrizedrawList.customerId?void 0!==s.getPrizedrawList.stationId&&""!=s.getPrizedrawList.stationId?a.open({templateUrl:"tpl/system/prizedraw/addPrizedraw.html",controller:"btnClickAddPrizedrawCon",size:"md",resolve:{parentScope:s,info:{}}}):n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"请选择站点"):n.pop("info",constantsLang[s.app.myData.lang].tips.tip,"请选择客户")},app.controller("btnClickEditPrizedrawCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,s){t.info=e,t.startDate=t.info.startTime,t.stopDate=t.info.endTime,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=l.cmdType.CHANGE,t.info.isForbidden=1,t.info.startTime=$("#startDate").val(),t.info.endTime=$("#stopDate").val(),console.log(t.info),t.callback3=function(t){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.editSuccess,l.TIMEOUT.timeout1s),a.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},o.myPost2(l.URL.systemUrl,t.info,l.msgIdName.managePrizeDrawMsgId,l.msgIdName.managePrizeDrawMsgName,t.callback3,a),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.editingData)},t.cancel=function(){a.dismiss(0)}}]),s.btnClickEditPrizedraw=function(){var t=s.gridOptions.$gridScope.selectedItems;console.log(t[0]),0==t.length?n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/prizedraw/editPrizedraw.html",controller:"btnClickEditPrizedrawCon",size:"md",resolve:{parentScope:s,info:t[0]}})},app.controller("btnClickDelPrizedrawCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,s){t.info=e,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=l.cmdType.DEL,t.callback3=function(t){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.deleteSuccess,l.TIMEOUT.timeout1s),a.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},o.myPost2(l.URL.systemUrl,t.info,l.msgIdName.managePrizeDrawMsgId,l.msgIdName.managePrizeDrawMsgName,t.callback3,a),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.deletingData)},t.cancel=function(){a.dismiss(0)}}]),s.btnClickDelPrizedraw=function(){var t=s.gridOptions.$gridScope.selectedItems;0==t.length?n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/prizedraw/delPrizedraw.html",controller:"btnClickDelPrizedrawCon",size:"md",resolve:{parentScope:s,info:t[0]}})}}]);