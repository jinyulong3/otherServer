app.controller("prizetacticManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(i,a,n,o,s,t){i.flag="queryPrizetactic",(i.parent=i).host=window.location.host,i.getPrizetacticSendData={sessionId:i.app.myData.sessionId,customerId:"",prizeDrawId:0,type:0,limit:"",offset:""},i.flags=[{id:1,name:"同时满足"},{id:2,name:"满足任意一条"}],i.selected_customerId="0",s.getStationListSendData.sessionId=i.app.myData.sessionId,1==i.app.myData.role&&i.selectCustomerChange(),i.search_select_prizedraw_list=[],s.getPrizedrawListSendData.sessionId=i.app.myData.sessionId,i.selectPrizetacticChange=function(){i.getPrizetacticSendData.prizeDrawId=i.selected_prizedrawId,console.log(i.getPrizetacticSendData),i.goQuery()},i.filterOptions={filterText:"",useExternalFilter:!0},i.totalServerItems=0,i.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},i.columnDefs=[{field:"customerId",displayName:t.instant("items.customerManage.customerNo"),width:"*",visible:!1},{field:"customerName",displayName:t.instant("items.customerManage.customerName"),width:"*",visible:!1},{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*",visible:!1},{field:"stationName",displayName:t.instant("items.stationManage.stationName"),width:"*",visible:!1},{field:"prizeDrawId",displayName:"项目编号",width:"*",visible:!1},{field:"prizeDrawName",displayName:"抽奖项目名称",width:"150",visible:!1},{field:"prizeTacticId",displayName:"策略编号",width:"*"},{field:"prizeTacticName",displayName:"策略名称",width:"180"},{field:"isForbidden",displayName:"是否禁用",width:"*",cellClass:"red",cellFilter:"filterPrizeDrawIsForbidden"},{field:"flag",displayName:"策略条件",width:"*",cellFilter:"filterPrizetacticFlag"},{field:"byNozzleNo",displayName:"按枪抽奖",width:"*",cellFilter:"filterIsForbidden"},{field:"nozzleNos",displayName:"枪号列表",width:"*"},{field:"byAmount",displayName:"满金额抽奖",width:"*",cellFilter:"filterIsForbidden"},{field:"amount",displayName:"最小金额（元）",width:"*",cellFilter:"filterInt2Decimal"},{field:"byQuantity",displayName:"满升抽奖",width:"*",cellFilter:"filterIsForbidden"},{field:"quantity",displayName:"最小升数（升）",width:"*",cellFilter:"filterInt2Decimal"},{field:"time_insert",displayName:"创建时间",width:"*",cellFilter:"filterDateStringSplitMs"},{field:"time_update",displayName:"修改时间",width:"*",cellFilter:"filterDateStringSplitMs"}],i.callback=function(t){console.log(t),i.myData=t.prizeTacticList,i.totalServerItems=t.allCount,n.clear()},i.setPagingData=function(t,a){i.getPrizetacticSendData.offset=1==t?0:(t-1)*a,i.getPrizetacticSendData.limit=a,o.myPost2(s.URL.systemUrl,i.getPrizetacticSendData,s.msgIdName.queryPrizetacticMsgId,s.msgIdName.queryPrizetacticMsgName,i.callback)},i.getPagedDataAsync=function(t,a,e){setTimeout(function(){n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.loadingData),i.setPagingData(a,t)},100)},i.$watch("pagingOptions",function(t,a){t!==a&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.$watch("filterOptions",function(t,a){t!==a&&i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},!0),i.gridOptions={i18n:"undefined"!=i.app.myData.lang?i.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:i.pagingOptions,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:i.filterOptions},i.goQuery=function(){void 0!==i.info&&void 0!==i.info.customerId&&""!=i.info.customerId?(i.getPrizetacticSendData.customerId=i.info.customerId,void 0!==i.info.stationId&&""!=i.info.stationId?void 0!==i.getPrizetacticSendData.prizeDrawId&&""!=i.getPrizetacticSendData.prizeDrawId&&"0"!=i.getPrizetacticSendData.prizeDrawId?i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择抽奖项目"):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择站点")):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择客户")},i.btnClickForbiddenPrizetactic=function(){var t=i.gridOptions.$gridScope.selectedItems;if(console.log(t[0]),0==t.length)n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow);else{var a=JSON.parse(JSON.stringify(t[0]));if(1==a.isForbidden)return void n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"该项目是禁用状态");a.isForbidden=1,a.sessionId=i.app.myData.sessionId,a.datatype=s.cmdType.CHANGE;o.myPost2(s.URL.systemUrl,a,s.msgIdName.managePrizetacticMsgId,s.msgIdName.managePrizetacticMsgName,function(t){console.log(t),n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,"已禁用",s.TIMEOUT.timeout1s),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},null),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,"正在禁用中...")}},i.btnClickNoForbiddenPrizetactic=function(){var t=i.gridOptions.$gridScope.selectedItems;if(console.log(t[0]),0==t.length)n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow);else{var a=JSON.parse(JSON.stringify(t[0]));if(0==a.isForbidden)return void n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"该项目是启用状态");a.isForbidden=0,a.sessionId=i.app.myData.sessionId,a.datatype=s.cmdType.CHANGE;o.myPost2(s.URL.systemUrl,a,s.msgIdName.managePrizetacticMsgId,s.msgIdName.managePrizetacticMsgName,function(t){console.log(t),n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,"已禁用",s.TIMEOUT.timeout1s),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},null),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,"正在启用中...")}},app.controller("btnClickAddPrizetacticCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,i){t.parent=i,t.info=e,t.flags=i.flags,t.info.customerId=i.getPrizetacticSendData.customerId,t.info.stationId=i.getPrizetacticSendData.stationId,t.info.prizeDrawId=i.getPrizetacticSendData.prizeDrawId,console.log(e),t.ok=function(){t.info.sessionId=i.app.myData.sessionId,t.info.datatype=s.cmdType.ADD,t.info.byNozzleNo=t.byNozzleNo_bool?1:0,t.info.byQuantity=t.byQuantity_bool?1:0,t.info.byAmount=t.byAmount_bool?1:0,t.info.amount=100*t.info.amount_decimal,t.info.quantity=100*t.info.quantity_decimal,console.log(t.info),t.callback2=function(t){console.log(t),n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.addSuccess,s.TIMEOUT.timeout1s),a.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},o.myPost2(s.URL.systemUrl,t.info,s.msgIdName.managePrizetacticMsgId,s.msgIdName.managePrizetacticMsgName,t.callback2,a),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.addingData)},t.cancel=function(){console.log(t.info),a.dismiss(0)}}]),i.btnClickAddPrizetactic=function(){var t=i;console.log(i.getPrizetacticSendData),i.getPrizetacticSendData.customerId=i.info.customerId,void 0!==i.getPrizetacticSendData.customerId&&""!=i.getPrizetacticSendData.customerId?void 0!==i.getPrizetacticSendData.stationId&&""!=i.getPrizetacticSendData.stationId?void 0!==i.getPrizetacticSendData.prizeDrawId&&""!=i.getPrizetacticSendData.prizeDrawId&&"0"!=i.getPrizetacticSendData.prizeDrawId?a.open({templateUrl:"tpl/system/prizetactic/addPrizetactic.html",controller:"btnClickAddPrizetacticCon",size:"md",resolve:{parentScope:t,info:{}}}):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择抽奖项目"):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择站点"):n.pop("info",constantsLang[i.app.myData.lang].tips.tip,"请选择客户")},app.controller("btnClickEditPrizetacticCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,i){t.info=e,t.flags=i.flags,t.byNozzleNo_bool=1==t.info.byNozzleNo,t.byQuantity_bool=1==t.info.byQuantity,t.byAmount_bool=1==t.info.byAmount,t.info.amount_decimal=t.info.amount/100,t.info.quantity_decimal=t.info.quantity/100,t.ok=function(){t.info.sessionId=i.app.myData.sessionId,t.info.datatype=s.cmdType.CHANGE,t.info.byNozzleNo=t.byNozzleNo_bool?1:0,t.info.byQuantity=t.byQuantity_bool?1:0,t.info.byAmount=t.byAmount_bool?1:0,t.info.amount=100*t.info.amount_decimal,t.info.quantity=100*t.info.quantity_decimal,t.callback3=function(t){n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.editSuccess,s.TIMEOUT.timeout1s),a.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},o.myPost2(s.URL.systemUrl,t.info,s.msgIdName.managePrizetacticMsgId,s.msgIdName.managePrizetacticMsgName,t.callback3,a),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.editingData)},t.cancel=function(){a.dismiss(0)}}]),i.btnClickEditPrizetactic=function(){var t=i.gridOptions.$gridScope.selectedItems;console.log(t[0]),0==t.length?n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/prizetactic/editPrizetactic.html",controller:"btnClickEditPrizetacticCon",size:"md",resolve:{parentScope:i,info:t[0]}})},app.controller("btnClickDelPrizetacticCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,i){t.info=e,t.ok=function(){t.info.sessionId=i.app.myData.sessionId,t.info.datatype=s.cmdType.DEL,t.callback3=function(t){n.clear(),n.pop("success",constantsLang[i.app.myData.lang].tips.success,constantsLang[i.app.myData.lang].tips.deleteSuccess,s.TIMEOUT.timeout1s),a.dismiss(0),i.getPagedDataAsync(i.pagingOptions.pageSize,i.pagingOptions.currentPage,i.filterOptions.filterText)},o.myPost2(s.URL.systemUrl,t.info,s.msgIdName.managePrizetacticMsgId,s.msgIdName.managePrizetacticMsgName,t.callback3,a),n.pop("wait",constantsLang[i.app.myData.lang].load.reqData,constantsLang[i.app.myData.lang].load.deletingData)},t.cancel=function(){a.dismiss(0)}}]),i.btnClickDelPrizetactic=function(){var t=i.gridOptions.$gridScope.selectedItems;0==t.length?n.pop("info",constantsLang[i.app.myData.lang].tips.tip,constantsLang[i.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/prizetactic/delPrizetactic.html",controller:"btnClickDelPrizetacticCon",size:"md",resolve:{parentScope:i,info:t[0]}})}}]);