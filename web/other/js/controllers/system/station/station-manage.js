app.controller("stationManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(e,a,s,i,o,t){e.selected_customerId=0,e.app.myData.customerListNoAll=e.app.myData.customerList.slice(0),"0"==e.app.myData.customerListNoAll[0].customerId&&e.app.myData.customerListNoAll.splice(0,1),0!=e.app.myData.role&&(e.selected_customerId=e.app.myData.customerListNoAll[0].customerId),e.selectChange=function(){console.log(e.selected_customerId),"0"!=e.selected_customerId?e.getStationListSendData.where=" customerId='"+e.selected_customerId+"'":e.getStationListSendData.where="",e.getPagedDataAsync(e.pagingOptions.pageSize,1,e.getStationListSendData)},e.getStationListSendData={sessionId:e.app.myData.sessionId,tableName:"view_station_customer",fields:[],where:"",limit:"",offset:""},e.filterOptions={filterText:"",useExternalFilter:!0},e.totalServerItems=0,e.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},e.columnDefs=[{field:"customerId",displayName:t.instant("items.customerManage.customerNo"),width:"*"},{field:"customerName",displayName:t.instant("items.customerManage.customerName"),width:"*"},{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:t.instant("items.stationManage.stationName"),width:"*"},{field:"manager",displayName:t.instant("items.stationManage.manager"),width:"*"},{field:"address",displayName:t.instant("items.stationManage.address"),width:"*"},{field:"phoneNum",displayName:t.instant("items.stationManage.phoneNum"),width:"*"},{field:"time_insert",displayName:t.instant("items.stationManage.regTime"),width:"*",cellFilter:"filterDateStringSplitMs"}],e.callback=function(t){e.myData=t.fieldValues,e.totalServerItems=t.allCount,s.clear()},e.setPagingData=function(t,a){e.getStationListSendData.offset=1==t?0:(t-1)*a,e.getStationListSendData.limit=a,i.myPost2(o.URL.systemUrl,e.getStationListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,e.callback)},e.getPagedDataAsync=function(t,a,n){setTimeout(function(){s.pop("wait",constantsLang[e.app.myData.lang].load.reqData,constantsLang[e.app.myData.lang].load.loadingData),e.setPagingData(a,t)},100)},e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage),e.$watch("pagingOptions",function(t,a){t!==a&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.$watch("filterOptions",function(t,a){t!==a&&e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},!0),e.gridOptions={i18n:"undefined"!=e.app.myData.lang?e.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:e.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:e.filterOptions},app.controller("btnClickAddStationCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,n,e){t.info=n,t.customerListNoAll=e.app.myData.customerListNoAll,t.info.customerId=t.customerListNoAll[0].customerId,t.ok=function(){t.info.sessionId=e.app.myData.sessionId,t.info.datatype=o.cmdType.ADD,t.callback2=function(t){s.clear(),s.pop("success",constantsLang[e.app.myData.lang].tips.success,constantsLang[e.app.myData.lang].tips.addSuccess,o.TIMEOUT.timeout1s),a.dismiss(0),e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.stationManageMsgId,o.msgIdName.stationManageMsgName,t.callback2,a),s.pop("wait",constantsLang[e.app.myData.lang].load.reqData,constantsLang[e.app.myData.lang].load.addingData)},t.cancel=function(){console.log(t.info),a.dismiss(0)}}]),e.btnClickAddStation=function(){a.open({templateUrl:"tpl/system/station/addStation.html",controller:"btnClickAddStationCon",size:"md",resolve:{parentScope:e,info:function(){return{}}}})},app.controller("btnClickEditStationCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,n,e){t.info=n,t.ok=function(){t.info.sessionId=e.app.myData.sessionId,t.info.datatype=o.cmdType.CHANGE,t.callback3=function(n){s.clear(),s.pop("success",constantsLang[e.app.myData.lang].tips.success,constantsLang[e.app.myData.lang].tips.editSuccess,o.TIMEOUT.timeout1s),a.dismiss(0),void 0!==e.app.myData.stationList&&e.app.myData.stationList.forEach(function(t,a){t.stationId==n.stationId&&(e.app.myData.stationList[a].stationName=n.stationName)}),e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.stationManageMsgId,o.msgIdName.stationManageMsgName,t.callback3,a),s.pop("wait",constantsLang[e.app.myData.lang].load.reqData,constantsLang[e.app.myData.lang].load.editingData)},t.cancel=function(){a.dismiss(0)}}]),e.btnClickEditStation=function(){var t=e.gridOptions.$gridScope.selectedItems;console.log(t[0]),0==t.length?s.pop("info",constantsLang[e.app.myData.lang].tips.tip,constantsLang[e.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/station/editStation.html",controller:"btnClickEditStationCon",size:"md",resolve:{parentScope:e,info:function(){return{stationId:t[0].stationId,stationName:t[0].stationName,address:t[0].address,manager:t[0].manager,phoneNum:t[0].phoneNum,qrCodePayGroupId:t[0].qrCodePayGroupId,qrCodePayStationId:t[0].qrCodePayStationId}}}})},app.controller("btnClickDelStationCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,n,e){t.info=n,t.ok=function(){t.info.sessionId=e.app.myData.sessionId,t.info.datatype=o.cmdType.DEL,t.callback3=function(t){s.clear(),s.pop("success",constantsLang[e.app.myData.lang].tips.success,constantsLang[e.app.myData.lang].tips.deleteSuccess,o.TIMEOUT.timeout1s),a.dismiss(0),e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.stationManageMsgId,o.msgIdName.stationManageMsgName,t.callback3,a),s.pop("wait",constantsLang[e.app.myData.lang].load.reqData,constantsLang[e.app.myData.lang].load.deletingData)},t.cancel=function(){a.dismiss(0)}}]),e.btnClickDelStation=function(){var t=e.gridOptions.$gridScope.selectedItems;0==t.length?s.pop("info",constantsLang[e.app.myData.lang].tips.tip,constantsLang[e.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/station/delStation.html",controller:"btnClickDelStationCon",size:"md",resolve:{parentScope:e,info:function(){return{stationId:t[0].stationId,stationName:t[0].stationName}}}})},app.controller("btnClickSetPswCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,n,e){t.info=n,console.log(n),t.ok=function(){t.info.sessionId=e.app.myData.sessionId,t.info.datatype=o.cmdType.CHANGEPSW,t.callback3=function(t){s.clear(),s.pop("success",constantsLang[e.app.myData.lang].tips.success,"修改上货/清货密码成功",o.TIMEOUT.timeout1s),a.dismiss(0),e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,t.info,o.msgIdName.stationManageMsgId,o.msgIdName.stationManageMsgName,t.callback3,a),s.pop("wait",constantsLang[e.app.myData.lang].load.reqData,"修改上货/清货密码中...")},t.cancel=function(){a.dismiss(0)}}]),e.btnClickSetPsw=function(){var t=e.gridOptions.$gridScope.selectedItems;0==t.length?s.pop("info",constantsLang[e.app.myData.lang].tips.tip,constantsLang[e.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/station/setPsw.html",controller:"btnClickSetPswCon",size:"md",resolve:{parentScope:e,info:function(){return{stationId:t[0].stationId,stationName:t[0].stationName}}}})}}]);