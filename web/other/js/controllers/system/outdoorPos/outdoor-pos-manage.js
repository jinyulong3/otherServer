app.controller("outdoorPosManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(o,e,s,n,i,t){o.selected_customerId="0",o.app.myData.customerListNoAll=o.app.myData.customerList.slice(0),console.log(o.app.myData.customerListNoAll),"0"==o.app.myData.customerListNoAll[0].customerId&&o.app.myData.customerListNoAll.splice(0,1),o.default_search_select_station_list={stationId:"0",stationName:t.instant("public.all")},o.search_select_station_list=[o.default_search_select_station_list],o.selected_stationId="0",i.getStationListSendData.sessionId=o.app.myData.sessionId,0!=o.app.myData.role&&(o.selected_customerId=o.app.myData.customerListNoAll[0].customerId),o.callback_getStationList=function(t){o.search_select_station_list=o.search_select_station_list.concat(t.fieldValues),"0"!=o.selected_customerId?o.getOutdoorPosListSendData.where=" customerId='"+o.selected_customerId+"'":o.getOutdoorPosListSendData.where="",1!=o.pagingOptions.currentPage&&(o.pagingOptions.currentPage=1)},o.selectCustomerChange=function(){console.log(o.selected_customerId),o.search_select_station_list=[o.default_search_select_station_list],"0"!=o.selected_customerId?i.getStationListSendData.where=" customerId='"+o.selected_customerId+"'":i.getStationListSendData.where="",n.myPost2(i.URL.systemUrl,i.getStationListSendData,i.msgIdName.normalSelectMsgId,i.msgIdName.normalSelectMsgName,o.callback_getStationList)},1==o.app.myData.role&&o.selectCustomerChange(),o.selectStationChange=function(){console.log(o.selected_customerId),"0"!=o.selected_stationId?o.getOutdoorPosListSendData.where=" stationId='"+o.selected_stationId+"'":"0"!=o.selected_customerId?o.getOutdoorPosListSendData.where=" customerId='"+o.selected_customerId+"'":o.getOutdoorPosListSendData.where="",1!=o.pagingOptions.currentPage?o.pagingOptions.currentPage=1:o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage)},o.getOutdoorPosListSendData={sessionId:o.app.myData.sessionId,tableName:"view_outdoorQRDevice_customer_station",fields:[],where:"",limit:"",offset:""},o.filterOptions={filterText:"",useExternalFilter:!0},o.totalServerItems=0,o.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},o.columnDefs=[{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:t.instant("items.stationManage.stationName"),width:"*"},{field:"deviceNum",displayName:t.instant("items.outdoorPosManage.outdoorPosNo"),width:"*"},{field:"bindNozzleNums",displayName:t.instant("items.outdoorPosManage.bindNozzlesNo"),width:"*"},{field:"createTime",displayName:t.instant("items.switchManage.createTime"),width:"*",cellFilter:"filterDateStringSplitMs"}],o.callback=function(t){o.myData=t.fieldValues,o.totalServerItems=t.allCount,s.clear()},o.setPagingData=function(t,e){o.getOutdoorPosListSendData.offset=1==t?0:(t-1)*e,o.getOutdoorPosListSendData.limit=e,n.myPost2(i.URL.systemUrl,o.getOutdoorPosListSendData,i.msgIdName.normalSelectMsgId,i.msgIdName.normalSelectMsgName,o.callback)},o.getPagedDataAsync=function(t,e,a){setTimeout(function(){s.pop("wait",constantsLang[o.app.myData.lang].load.reqData,constantsLang[o.app.myData.lang].load.loadingData),o.setPagingData(e,t)},100)},o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage),o.$watch("pagingOptions",function(t,e){t!==e&&o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage,o.filterOptions.filterText)},!0),o.$watch("filterOptions",function(t,e){t!==e&&o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage,o.filterOptions.filterText)},!0),o.gridOptions={i18n:"undefined"!=o.app.myData.lang?o.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:o.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:o.filterOptions},app.controller("btnClickAddOutdoorPosCon",["$scope","$uibModalInstance","info","parentScope",function(e,a,t,o){e.type2="hasNozzleSelect",e.parent=o,e.info=t,e.customerListNoAll=o.app.myData.customerListNoAll,e.info.customerId=e.customerListNoAll[0].customerId,e.stationListNoAll=[],e.ok=function(){e.info.bindNozzleNums="";for(var t=0;t<e.nozzleNums.length;t++)0==t?e.info.bindNozzleNums=e.nozzleNums[t]:e.info.bindNozzleNums+=","+e.nozzleNums[t];e.info.sessionId=o.app.myData.sessionId,e.info.datatype=i.cmdType.ADD,e.callback2=function(t){s.clear(),s.pop("success",constantsLang[o.app.myData.lang].tips.success,constantsLang[o.app.myData.lang].tips.addSuccess,i.TIMEOUT.timeout1s),a.dismiss(0),o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage,o.filterOptions.filterText)},n.myPost2(i.URL.systemUrl,e.info,i.msgIdName.outdoorPosManageMsgId,i.msgIdName.outdoorPosManageMsgName,e.callback2,a)},e.cancel=function(){a.dismiss(0)}}]),o.btnClickAddOil=function(){e.open({templateUrl:"tpl/system/outdoorPos/addOutdoorPos.html",controller:"btnClickAddOutdoorPosCon",size:"md",resolve:{parentScope:o,info:{}}})},app.controller("btnClickEditOutdoorPosCon",["$scope","$uibModalInstance","info","parentScope",function(o,e,t,a){o.info=t,o.nozzleNumListNoAllFieldValues=[],o.nozzleNumListNoAll=[],o._callback4=function(t){console.log(t),o.nozzleNumListNoAllFieldValues=t.fieldValues,$.each(o.nozzleNumListNoAllFieldValues,function(t,e){var a={id:e.nozzleNum,text:e.nozzleNum+"号枪"};o.nozzleNumListNoAll.push(a)})},o.getNozzleNum=function(){i.getNormalListSendData.sessionId=a.app.myData.sessionId,i.getNormalListSendData.tableName="nozzleinfo",i.getNormalListSendData.where=" stationId='"+o.info.stationId+"'",n.myPost2(i.URL.systemUrl,i.getNormalListSendData,i.msgIdName.normalSelectMsgId,i.msgIdName.normalSelectMsgName,o._callback4)},o.getNozzleNum(),o.ok=function(){o.info.bindNozzleNums="";for(var t=0;t<o.nozzleNums.length;t++)0==t?o.info.bindNozzleNums=o.nozzleNums[t]:o.info.bindNozzleNums+=","+o.nozzleNums[t];o.info.sessionId=a.app.myData.sessionId,o.info.datatype=i.cmdType.CHANGE,o.callback3=function(t){s.clear(),s.pop("success",constantsLang[a.app.myData.lang].tips.success,constantsLang[a.app.myData.lang].tips.editSuccess,i.TIMEOUT.timeout1s),e.dismiss(0),a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.filterOptions.filterText)},n.myPost2(i.URL.systemUrl,o.info,i.msgIdName.outdoorPosManageMsgId,i.msgIdName.outdoorPosManageMsgName,o.callback3,e),s.pop("wait",constantsLang[a.app.myData.lang].load.reqData,constantsLang[a.app.myData.lang].load.editingData)},o.cancel=function(){e.dismiss(0)}}]),o.btnClickEditOil=function(){var t=o.gridOptions.$gridScope.selectedItems;console.log(t[0]),0==t.length?s.pop("info",constantsLang[o.app.myData.lang].tips.tip,constantsLang[o.app.myData.lang].tips.noSelectRow):e.open({templateUrl:"tpl/system/outdoorPos/editOutdoorPos.html",controller:"btnClickEditOutdoorPosCon",size:"md",resolve:{parentScope:o,info:t[0]}})},app.controller("btnClickDelOutdoorPosCon",["$scope","$uibModalInstance","info","parentScope",function(t,e,a,o){t.info=a,t.ok=function(){t.info.sessionId=o.app.myData.sessionId,t.info.datatype=i.cmdType.DEL,t.callback3=function(t){s.clear(),s.pop("success",constantsLang[o.app.myData.lang].tips.success,constantsLang[o.app.myData.lang].tips.deleteSuccess,i.TIMEOUT.timeout1s),e.dismiss(0),o.getPagedDataAsync(o.pagingOptions.pageSize,o.pagingOptions.currentPage,o.filterOptions.filterText)},n.myPost2(i.URL.systemUrl,t.info,i.msgIdName.outdoorPosManageMsgId,i.msgIdName.outdoorPosManageMsgName,t.callback3,e),s.pop("wait",constantsLang[o.app.myData.lang].load.reqData,constantsLang[o.app.myData.lang].load.deletingData)},t.cancel=function(){e.dismiss(0)}}]),o.btnClickDelOil=function(){var t=o.gridOptions.$gridScope.selectedItems;0==t.length?s.pop("info",constantsLang[o.app.myData.lang].tips.tip,constantsLang[o.app.myData.lang].tips.noSelectRow):e.open({templateUrl:"tpl/system/outdoorPos/delOutdoorPos.html",controller:"btnClickDelOutdoorPosCon",size:"md",resolve:{parentScope:o,info:t[0]}})}}]);