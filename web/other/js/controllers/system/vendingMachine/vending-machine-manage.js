app.controller("vendingMachineManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(n,t,i,s,o,e){n.getVendingMachineListSendData={sessionId:n.app.myData.sessionId,tableName:"view_vending_machines_station_customer",fields:[],where:"",limit:"",offset:""},n.filterOptions={filterText:"",useExternalFilter:!0},n.totalServerItems=0,n.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},n.setPagingData=function(e,t){n.getVendingMachineListSendData.offset=1==e?0:(e-1)*t,n.getVendingMachineListSendData.limit=t,s.myPost2(o.URL.systemUrl,n.getVendingMachineListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,n.callback)},n.getPagedDataAsync=function(e,t,a){setTimeout(function(){i.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.loadingData),n.setPagingData(t,e)},100)},n.selected_customerId="0",n.app.myData.customerListNoAll=n.app.myData.customerList.slice(0),"0"==n.app.myData.customerListNoAll[0].customerId&&n.app.myData.customerListNoAll.splice(0,1),0!=n.app.myData.role&&(n.selected_customerId=n.app.myData.customerListNoAll[0].customerId),n.default_search_select_station_list={stationId:"0",stationName:e.instant("public.all")},n.search_select_station_list=[n.default_search_select_station_list],n.selected_stationId="0",o.getStationListSendData.sessionId=n.app.myData.sessionId,n.callback_getStationList=function(e){n.search_select_station_list=n.search_select_station_list.concat(e.fieldValues),"0"!=n.selected_customerId?n.getVendingMachineListSendData.where=" customerId='"+n.selected_customerId+"'":n.getVendingMachineListSendData.where="",1!=n.pagingOptions.currentPage&&(n.pagingOptions.currentPage=1)},n.selectCustomerChange=function(){console.log(n.selected_customerId),n.search_select_station_list=[n.default_search_select_station_list],"0"!=n.selected_customerId?(o.getStationListSendData.where=" customerId='"+n.selected_customerId+"'",n.getVendingMachineListSendData.where=" customerId='"+n.selected_customerId+"'",n.pagingOptions.currentPage=1,n.app.myData.role<1&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage)):(o.getStationListSendData.where="",n.getVendingMachineListSendData.where="",n.pagingOptions.currentPage=1,n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage)),s.myPost2(o.URL.systemUrl,o.getStationListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,n.callback_getStationList)},1==n.app.myData.role&&n.selectCustomerChange(),n.selectStationChange=function(){console.log(n.selected_customerId),"0"!=n.selected_stationId?n.getVendingMachineListSendData.where=" stationId='"+n.selected_stationId+"'":"0"!=n.selected_customerId?n.getVendingMachineListSendData.where=" customerId='"+n.selected_customerId+"'":n.getVendingMachineListSendData.where="",1!=n.pagingOptions.currentPage?n.pagingOptions.currentPage=1:n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage)},n.columnDefs=[{field:"customerId",displayName:e.instant("items.customerManage.customerNo"),width:"*"},{field:"customerName",displayName:e.instant("items.customerManage.customerName"),width:"*"},{field:"stationId",displayName:e.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:e.instant("items.stationManage.stationName"),width:"*"},{field:"deviceId",displayName:"售卖机编号",width:"*"},{field:"displayName",displayName:"售卖机名称",width:"*"},{field:"channelRowCount",displayName:"货道行数",width:"*"},{field:"channelColCount",displayName:"货道列数",width:"*"},{field:"status",displayName:"状态",cellFilter:"filterDeviceStatus",width:"*"},{field:"time_insert",displayName:"创建时间",width:"*",cellFilter:"filterDateStringSplitMs"}],n.callback=function(e){n.myData=e.fieldValues,n.totalServerItems=e.allCount,i.clear()},n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage),n.$watch("pagingOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.$watch("filterOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.gridOptions={i18n:"undefined"!=n.app.myData.lang?n.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:n.pagingOptions,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:n.filterOptions},app.controller("btnClickAddVendingMachineCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,n){e.parent=n,e.info=a,e.customerListNoAll=n.app.myData.customerListNoAll,e.info.customerId=e.customerListNoAll[0].customerId,e.stationListNoAll=[],e.ok=function(){e.info.sessionId=n.app.myData.sessionId,e.info.datatype=o.cmdType.ADD,console.log(e.info),e.callback2=function(e){i.clear(),i.pop("success",constantsLang[n.app.myData.lang].tips.success,constantsLang[n.app.myData.lang].tips.addSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.vendingMachineManageMsgId,o.msgIdName.vendingMachineManageMsgName,e.callback2,t),i.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.addingData)},e.cancel=function(){console.log(e.info),t.dismiss(0)}}]),n.btnClickAddVendingMachine=function(){t.open({templateUrl:"tpl/system/vendingMachine/addVendingMachine.html",controller:"btnClickAddVendingMachineCon",size:"md",resolve:{parentScope:n,info:{}}})},app.controller("btnClickEditVendingMachineCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,n){e.info=a,e.ok=function(){e.info.sessionId=n.app.myData.sessionId,e.info.datatype=o.cmdType.CHANGE,console.log(e.info),e.callback3=function(e){i.clear(),i.pop("success",constantsLang[n.app.myData.lang].tips.success,constantsLang[n.app.myData.lang].tips.editSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.vendingMachineManageMsgId,o.msgIdName.vendingMachineManageMsgName,e.callback3,t),i.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.editingData)},e.cancel=function(){t.dismiss(0)}}]),n.btnClickEditVendingMachine=function(){var e=n.gridOptions.$gridScope.selectedItems;console.log(e[0]),0==e.length?i.pop("info",constantsLang[n.app.myData.lang].tips.tip,constantsLang[n.app.myData.lang].tips.noSelectRow):t.open({templateUrl:"tpl/system/vendingMachine/editVendingMachine.html",controller:"btnClickEditVendingMachineCon",size:"md",resolve:{parentScope:n,info:e[0]}})},app.controller("btnClickDelVendingMachineCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,n){e.info=a,e.ok=function(){e.info.sessionId=n.app.myData.sessionId,e.info.datatype=o.cmdType.DEL,e.callback3=function(e){i.clear(),i.pop("success",constantsLang[n.app.myData.lang].tips.success,constantsLang[n.app.myData.lang].tips.deleteSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},s.myPost2(o.URL.systemUrl,e.info,o.msgIdName.vendingMachineManageMsgId,o.msgIdName.vendingMachineManageMsgName,e.callback3,t),i.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.deletingData)},e.cancel=function(){t.dismiss(0)}}]),n.btnClickDelVendingMachine=function(){var e=n.gridOptions.$gridScope.selectedItems;0==e.length?i.pop("info",constantsLang[n.app.myData.lang].tips.tip,constantsLang[n.app.myData.lang].tips.noSelectRow):t.open({templateUrl:"tpl/system/vendingMachine/delVendingMachine.html",controller:"btnClickDelVendingMachineCon",size:"md",resolve:{parentScope:n,info:e[0]}})}}]);