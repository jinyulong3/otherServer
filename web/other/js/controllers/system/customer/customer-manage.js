app.controller("customerManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(s,a,n,o,i,t){s.getCustomerListSendData={sessionId:s.app.myData.sessionId,tableName:"info_customer",fields:[],limit:"",offset:""},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.columnDefs=[{field:"customerId",displayName:t.instant("items.customerManage.customerNo"),width:"*"},{field:"customerName",displayName:t.instant("items.customerManage.customerName"),width:"*"},{field:"address",displayName:t.instant("items.customerManage.address"),width:"*"},{field:"manager",displayName:t.instant("items.customerManage.admin"),width:"*"},{field:"phoneNum",displayName:t.instant("items.customerManage.telephone"),width:"*"},{field:"level",displayName:t.instant("items.customerManage.level"),width:"*"},{field:"time_insert",displayName:t.instant("items.customerManage.regTime"),width:"*",cellFilter:"filterDateStringSplitMs"}],s.callback=function(t){s.myData=t.fieldValues,s.totalServerItems=t.allCount,n.clear()},s.setPagingData=function(t,a){s.getCustomerListSendData.offset=1==t?0:(t-1)*a,s.getCustomerListSendData.limit=a,o.myPost2(i.URL.systemUrl,s.getCustomerListSendData,i.msgIdName.normalSelectMsgId,i.msgIdName.normalSelectMsgName,s.callback)},s.getPagedDataAsync=function(t,a,e){setTimeout(function(){n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(a,t)},100)},s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage),s.$watch("pagingOptions",function(t,a){t!==a&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(t,a){t!==a&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:s.filterOptions},app.controller("btnClickAddCustomerCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,s){t.info=e,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=i.cmdType.ADD,t.info.level=1,t.callback2=function(t){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.addSuccess,i.TIMEOUT.timeout1s),a.dismiss(0),console.log(s.app.myData),s.app.myData.customerList.push({customerId:t.customerId,customerName:t.customerName}),s.app.myData.customerListNoAll.push({customerId:t.customerId,customerName:t.customerName}),console.log(s.app.myData),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},o.myPost2(i.URL.systemUrl,t.info,i.msgIdName.customerManageMsgId,i.msgIdName.customerManageMsgName,t.callback2,a),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.addingData)},t.cancel=function(){a.dismiss(0)}}]),s.btnClickAddCustomer=function(){a.open({templateUrl:"tpl/system/customer/addCustomer.html",controller:"btnClickAddCustomerCon",size:"md",resolve:{parentScope:s,info:function(){return{}}}})},app.controller("btnClickEditCustomerCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,s){t.info=e,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=i.cmdType.CHANGE,console.log(t.info),t.callback3=function(e){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.editSuccess,i.TIMEOUT.timeout1s),a.dismiss(0),s.app.myData.customerList.forEach(function(t,a){t.customerId==e.customerId&&(s.app.myData.customerList[a].customerName=e.customerName)}),s.app.myData.customerListNoAll.forEach(function(t,a){t.customerId==e.customerId&&(s.app.myData.customerListNoAll[a].customerName=e.customerName)}),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},o.myPost2(i.URL.systemUrl,t.info,i.msgIdName.customerManageMsgId,i.msgIdName.customerManageMsgName,t.callback3,a),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.editingData)},t.cancel=function(){a.dismiss(0)}}]),s.btnClickEditCustomer=function(){var t=s.gridOptions.$gridScope.selectedItems;console.log(t[0]),0==t.length?n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/customer/editCustomer.html",controller:"btnClickEditCustomerCon",size:"md",resolve:{parentScope:s,info:function(){return{customerId:t[0].customerId,customerName:t[0].customerName,address:t[0].address,manager:t[0].manager,phoneNum:t[0].phoneNum}}}})},app.controller("btnClickDelCustomerCon",["$scope","$uibModalInstance","info","parentScope",function(t,a,e,s){t.info=e,t.ok=function(){t.info.sessionId=s.app.myData.sessionId,t.info.datatype=i.cmdType.DEL,t.callback3=function(e){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.deleteSuccess,i.TIMEOUT.timeout1s),a.dismiss(0),s.app.myData.customerList.forEach(function(t,a){t.customerId==e.customerId&&s.app.myData.customerList.splice(a,1)}),s.app.myData.customerListNoAll.forEach(function(t,a){t.customerId==e.customerId&&s.app.myData.customerListNoAll.splice(a,1)}),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},o.myPost2(i.URL.systemUrl,t.info,i.msgIdName.customerManageMsgId,i.msgIdName.customerManageMsgName,t.callback3,a),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.deletingData)},t.cancel=function(){a.dismiss(0)}}]),s.btnClickDelCustomer=function(){var t=s.gridOptions.$gridScope.selectedItems;0==t.length?n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow):a.open({templateUrl:"tpl/system/customer/delCustomer.html",controller:"btnClickDelCustomerCon",size:"md",resolve:{parentScope:s,info:function(){return{customerId:t[0].customerId,customerName:t[0].customerName}}}})}}]);