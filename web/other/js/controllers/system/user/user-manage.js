app.controller("userManage",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$state","$translate",function(s,t,n,i,o,e,a){console.log(a.instant("title")),s.getUserListSendData={sessionId:s.app.myData.sessionId,tableName:"view_user_customer_station",fields:[],where:"",limit:"",offset:""},s.filterOptions={filterText:"",useExternalFilter:!0},s.totalServerItems=0,s.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},s.getPagedDataAsync=function(e,t,a){setTimeout(function(){n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.loadingData),s.setPagingData(t,e)},100)},s.selected_customerId="0",s.app.myData.customerListNoAll=s.app.myData.customerList.slice(0),"0"==s.app.myData.customerListNoAll[0].customerId&&s.app.myData.customerListNoAll.splice(0,1),0!=s.app.myData.role&&(s.selected_customerId=s.app.myData.customerListNoAll[0].customerId),s.default_search_select_station_list={stationId:"0",stationName:a.instant("public.all")},s.search_select_station_list=[s.default_search_select_station_list],s.selected_stationId="0",o.getStationListSendData.sessionId=s.app.myData.sessionId,s.callback_getStationList=function(e){s.search_select_station_list=s.search_select_station_list.concat(e.fieldValues),"0"!=s.selected_customerId?s.getUserListSendData.where=" customerId='"+s.selected_customerId+"'":s.getUserListSendData.where="",1!=s.pagingOptions.currentPage&&(s.pagingOptions.currentPage=1)},s.selectCustomerChange=function(){console.log(s.selected_customerId),s.search_select_station_list=[s.default_search_select_station_list],"0"!=s.selected_customerId?(o.getStationListSendData.where=" customerId='"+s.selected_customerId+"'",s.getUserListSendData.where=" customerId='"+s.selected_customerId+"'",s.pagingOptions.currentPage=1,s.app.myData.role<1&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage)):(o.getStationListSendData.where="",s.getUserListSendData.where="",s.pagingOptions.currentPage=1,s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage)),i.myPost2(o.URL.systemUrl,o.getStationListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,s.callback_getStationList)},1==s.app.myData.role&&s.selectCustomerChange(),s.selectStationChange=function(){console.log("选择站点"),"0"!=s.selected_stationId?s.getUserListSendData.where=" stationId='"+s.selected_stationId+"'":"0"!=s.selected_customerId?s.getUserListSendData.where=" customerId='"+s.selected_customerId+"'":s.getUserListSendData.where="",1!=s.pagingOptions.currentPage?s.pagingOptions.currentPage=1:s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage)},s.columnDefs=[{field:"customerId",displayName:a.instant("items.customerManage.customerNo"),width:"*"},{field:"customerName",displayName:a.instant("items.customerManage.customerName"),width:"*"},{field:"stationId",displayName:a.instant("items.stationManage.stationId"),width:"*"},{field:"stationName",displayName:a.instant("items.stationManage.stationName"),width:"*"},{field:"role",displayName:a.instant("items.userManage.role"),cellFilter:"filterUserRole:this"},{field:"phoneNum",displayName:a.instant("items.userManage.phoneNum"),width:"*"},{field:"name",displayName:a.instant("items.userManage.name"),width:"*"},{field:"time_insert",displayName:a.instant("items.stationManage.regTime"),width:"*",cellFilter:"filterDateStringSplitMs"}],s.callback=function(e){s.myData=e.fieldValues,s.totalServerItems=e.allCount,n.clear()},s.setPagingData=function(e,t){if(console.log("请求数据"),s.getUserListSendData.offset=1==e?0:(e-1)*t,s.getUserListSendData.limit=t,0==s.app.myData.role)-1==s.getUserListSendData.where.indexOf("customerId")&&-1==s.getUserListSendData.where.indexOf("stationId")&&(s.getUserListSendData.where="");else if(1==s.app.myData.role)-1==s.getUserListSendData.where.indexOf("customerId")&&-1==s.getUserListSendData.where.indexOf("stationId")&&(s.getUserListSendData.where=" customerId='"+s.app.myData.customerId+"'");else{if(2!=s.app.myData.role)return;-1==s.getUserListSendData.where.indexOf("stationId")&&(s.getUserListSendData.where=" stationId='"+s.app.myData.stationId+"'")}i.myPost2(o.URL.systemUrl,s.getUserListSendData,o.msgIdName.normalSelectMsgId,o.msgIdName.normalSelectMsgName,s.callback)},s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage),s.$watch("pagingOptions",function(e,t){e!==t&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.$watch("filterOptions",function(e,t){e!==t&&s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},!0),s.gridOptions={i18n:"undefined"!=s.app.myData.lang?s.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:s.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,filterOptions:s.filterOptions},app.controller("btnClickAddUserCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,s){e.parent=s,e.info=a,e.customerListNoAll=s.app.myData.customerListNoAll,e.info.customerId=e.customerListNoAll[0].customerId,e.stationListNoAll=[],e.ok=function(){e.info.sessionId=s.app.myData.sessionId,e.info.datatype=o.cmdType.ADD,e.callback2=function(e){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.addSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,e.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,e.callback2,t),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.addingData)},e.cancel=function(){t.dismiss(0)}}]),s.btnClickAddOil=function(){t.open({templateUrl:"tpl/system/user/addUser.html",controller:"btnClickAddUserCon",size:"md",resolve:{parentScope:s,info:function(){return{}}}})},app.controller("btnClickEditUserCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,s){e.info=a,e.ok=function(){e.info.sessionId=s.app.myData.sessionId,e.info.datatype=o.cmdType.CHANGE,console.log(e.info),e.callback3=function(e){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.editSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,e.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,e.callback3,t),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.editingData)},e.cancel=function(){t.dismiss(0)}}]),s.btnClickEditOil=function(){var e=s.gridOptions.$gridScope.selectedItems;0==e.length?n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow):t.open({templateUrl:"tpl/system/user/editUser.html",controller:"btnClickEditUserCon",size:"md",resolve:{parentScope:s,info:e[0]}})},app.controller("btnClickDelUserCon",["$scope","$uibModalInstance","info","parentScope",function(e,t,a,s){e.info=a,e.ok=function(){e.info.sessionId=s.app.myData.sessionId,e.info.datatype=o.cmdType.DEL,e.callback3=function(e){n.clear(),n.pop("success",constantsLang[s.app.myData.lang].tips.success,constantsLang[s.app.myData.lang].tips.deleteSuccess,o.TIMEOUT.timeout1s),t.dismiss(0),s.getPagedDataAsync(s.pagingOptions.pageSize,s.pagingOptions.currentPage,s.filterOptions.filterText)},i.myPost2(o.URL.systemUrl,e.info,o.msgIdName.userManageMsgId,o.msgIdName.userManageMsgName,e.callback3,t),n.pop("wait",constantsLang[s.app.myData.lang].load.reqData,constantsLang[s.app.myData.lang].load.deletingData)},e.cancel=function(){t.dismiss(0)}}]),s.btnClickDelOil=function(){var e=s.gridOptions.$gridScope.selectedItems;if(0==e.length)n.pop("info",constantsLang[s.app.myData.lang].tips.tip,constantsLang[s.app.myData.lang].tips.noSelectRow);else{if(e[0].phoneNum==s.app.myData.userId)return void n.pop("info","提示","不可删除当前登录用户");t.open({templateUrl:"tpl/system/user/delUser.html",controller:"btnClickDelUserCon",size:"md",resolve:{parentScope:s,info:e[0]}})}}}]);