app.controller("queryGoodsInSells",["$scope","$uibModal","toaster","httpJsonHandle","myConstants","$translate",function(n,e,o,a,i,t){n.myConstants=i,n.queryGoodsInSellsData={sessionId:n.app.myData.sessionId,customerId:"",stationId:"",deviceId:"",startTime:"2001-01-01",endTime:"2029-02-02",eventType:3,payType:0,limit:"",offset:""},n.payTypes=i.payTypes,n.eventTypes=i.eventTypes,n.filterOptions={filterText:"",useExternalFilter:!0},n.totalServerItems=0,n.pagingOptions={pageSizes:[10,15,25,50,100],pageSize:15,currentPage:1},n.columnDefs=[{field:"stationId",displayName:t.instant("items.stationManage.stationId"),width:"*"},{field:"deviceId",displayName:"设备编号",width:"*"},{field:"channelId",displayName:"货道号",width:"*"},{field:"channelName",displayName:"货道名称",width:"*"},{field:"goodId",displayName:"商品编号",width:"*"},{field:"goodName",displayName:"商品名称",width:"*"},{field:"goodCount",displayName:"商品个数",width:"*"},{field:"eventDateTime",displayName:"时间",width:"*",cellFilter:"filterDateStringSplitMs"},{field:"money",displayName:"金额",width:"*",cellFilter:"filterMoney"},{field:"payType",displayName:"支付方式",width:"*",cellFilter:"filterPayType:this"}],n.callback=function(e){n.myData=e.goodsInSellsList,n.totalServerItems=e.allCount,o.clear()},n.setPagingData=function(e,t){n.queryGoodsInSellsData.offset=1==e?0:(e-1)*t,n.queryGoodsInSellsData.limit=t,a.myPost2(i.URL.systemUrl,n.queryGoodsInSellsData,i.msgIdName.queryGoodsInSellsMsgId,i.msgIdName.queryGoodsInSellsMsgName,n.callback)},n.getPagedDataAsync=function(e,t,a){setTimeout(function(){o.pop("wait",constantsLang[n.app.myData.lang].load.reqData,constantsLang[n.app.myData.lang].load.loadingData),n.setPagingData(t,e)},100)},n.$watch("pagingOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.$watch("filterOptions",function(e,t){e!==t&&n.getPagedDataAsync(n.pagingOptions.pageSize,n.pagingOptions.currentPage,n.filterOptions.filterText)},!0),n.gridOptions={i18n:"undefined"!=n.app.myData.lang?n.app.myData.lang:"zh-cn",data:"myData",enablePaging:!0,showFooter:!0,footerRowHeight:40,totalServerItems:"totalServerItems",pagingOptions:n.pagingOptions,enableColumnResizing:!0,rowHeight:28,enableRowSelection:!0,multiSelect:!1,columnDefs:"columnDefs",enableColumnResize:!0,showSelectionCheckbox:!0,noUnselect:!0,filterOptions:n.filterOptions},n.goExcel=function(){console.log("开始导出excel"),n.inData();var e=JSON.parse(JSON.stringify(n.queryGoodsInSellsData));e.limit=1e3,e.offset=0,e.toExcel=1;a.myPost2(i.URL.systemUrl,e,i.msgIdName.queryGoodsInSellsMsgId,i.msgIdName.queryGoodsInSellsMsgName,function(e){console.log(e),console.log(window.location.host+"/web/"+e.excelPath),window.open("http://"+window.location.host+"/web/"+e.excelPath)})},n.goQuery=function(){n.inData(),n.getPagedDataAsync(n.pagingOptions.pageSize,1,n.filterOptions.filterText)},n.inData=function(){var e,t;void 0!==n.info&&"undefined"!=n.info.customerId?(n.queryGoodsInSellsData.customerId=n.info.customerId,void 0!==n.info.stationId&&"0"!=n.queryGoodsInSellsData.stationId?(n.queryGoodsInSellsData.stationId=n.info.stationId,void 0!==n.info.deviceId&&"0"!=n.info.deviceId?(n.queryGoodsInSellsData.deviceId=n.info.deviceId,n.startDate=$("#startDate").val(),n.stopDate=$("#stopDate").val(),e="2019-01-01",t="2100-01-01",""!=n.startDate&&(e=n.startDate),""!=n.stopDate&&(t=n.stopDate),n.queryGoodsInSellsData.startTime=e,n.queryGoodsInSellsData.stopTime=t):o.pop("info",constantsLang[n.app.myData.lang].tips.tip,"请选择售卖机")):o.pop("info",constantsLang[n.app.myData.lang].tips.tip,"请选择站点")):o.pop("info",constantsLang[n.app.myData.lang].tips.tip,"请选择客户")}}]);